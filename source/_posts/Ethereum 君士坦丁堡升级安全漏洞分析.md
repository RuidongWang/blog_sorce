# Ethereum 君士坦丁堡安全漏洞分析

## Ethereum 君士坦丁堡安全漏洞
智能合约中 `address.transfer(...)` 和 `address.send(...)` 存在重入攻击漏洞。

## 什么是重入攻击
谈到 Ethereum 的重入攻击就不得不提起 DAO 事件。

DAO 事件是一次完全去中心化的计划，这次计划的失败最终证明了，不存在完全的去中心化。

### 漏洞产生的情况
1. 合约中有一个函数 A，A 中在改变状态后调用了 transfer/send 函数。这种情况有的时候不是很明显，比如二次 transfer 或者内部调用另一个智能合约
2. 必须存在一个攻击者可访问的函数 B，其中（a）改变状态，（b）状态改变与函数 A 的状态改变冲突。
3. 函数 B 执行消耗需要小于 1600 gas （2300 gas 限制 - 700 gas(为 call 提供的)）

### 为什么此次升级会产生安全漏洞
在 Ethereum 拜占庭版本每个存储操作需要消耗至少 5000 gas，而 transfer/send 操作 gas 消耗要求小于 2300，在执行上述操作的时候会因为 gas 限制而无法执行。

在 Ethereum 中 call 操作可以调用 gas 

在 Ethereum 君士坦丁堡版本中，改良了 EVM 机制，从而减少了 gas 的消耗，因此出现了重入攻击的安全漏洞。
